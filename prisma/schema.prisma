generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  fullName    String
  username    String   @unique
  email       String   @unique
  password    String
  bio         String?
  image       String?
  imagePublic String?
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())

  // REMOVE THESE COMPLETELY â›”
  // profile   Profile?
  // profileId String?  @unique @db.ObjectId

  posts    Post[]    @relation("UserPosts")
  comments Comment[] @relation("UserComments")
  likes    Like[]    @relation("UserLikes")

  followers Follow[] @relation("Followers")
  following Follow[] @relation("Following")

  notificationsReceived Notification[] @relation("NotificationsReceived")
  notificationsSent     Notification[] @relation("NotificationsSent")

  @@map("Users")
}

model Post {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  text        String?
  image       String?
  imagePublic String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user   User   @relation("UserPosts", fields: [userId], references: [id])
  userId String @db.ObjectId

  comments      Comment[]      @relation("PostComments")
  likes         Like[]         @relation("PostLikes")
  notifications Notification[] @relation("PostNotifications")

  @@map("Posts")
}

model Comment {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  content   String
  postId    String   @db.ObjectId
  userId    String   @db.ObjectId
  createdAt DateTime @default(now())

  post Post @relation("PostComments", fields: [postId], references: [id])
  user User @relation("UserComments", fields: [userId], references: [id])

  @@map("Comments")
}

model Like {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  postId    String   @db.ObjectId
  createdAt DateTime @default(now())

  post Post @relation("PostLikes", fields: [postId], references: [id])
  user User @relation("UserLikes", fields: [userId], references: [id])

  @@unique([postId, userId])
  @@map("Likes")
}

model Follow {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now())

  follower   User   @relation("Following", fields: [followerId], references: [id])
  followerId String @db.ObjectId

  following   User   @relation("Followers", fields: [followingId], references: [id])
  followingId String @db.ObjectId

  @@unique([followerId, followingId])
  @@map("Follows")
}

model Notification {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  message   String
  type      String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  receiverId String  @db.ObjectId
  senderId   String  @db.ObjectId
  postId     String? @db.ObjectId

  receiver User  @relation("NotificationsReceived", fields: [receiverId], references: [id])
  sender   User  @relation("NotificationsSent", fields: [senderId], references: [id])
  post     Post? @relation("PostNotifications", fields: [postId], references: [id])

  @@map("Notifications")
}
